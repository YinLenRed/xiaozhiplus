# 🌤️ Python主动天气获取使用指南

## 📋 功能概述

现在您可以让Python主动获取天气并播报，不再依赖Java后端的MQTT推送。

## 🚀 快速开始

### 1. 立即播报天气

```bash
# 北京天气（默认）
python 无依赖天气获取.py

# 指定城市
python 无依赖天气获取.py 上海
python 无依赖天气获取.py 广州
python 无依赖天气获取.py 深圳
```

### 2. 使用快捷命令

```bash
# 显示帮助
python 天气.py help

# 各城市快捷方式
python 天气.py bj      # 北京
python 天气.py sh      # 上海  
python 天气.py gz      # 广州
python 天气.py sz      # 深圳

# 立即播报
python 天气.py now 北京
```

### 3. 定时天气播报

```bash
# 启动定时服务（8:00, 12:00, 18:00, 22:00自动播报）
python 定时天气播报.py start

# 快速测试
python 定时天气播报.py test
```

## 📊 功能特性

### ✅ 已实现功能

- **🌍 多城市支持**: 北京、上海、广州、深圳等
- **⏰ 定时播报**: 可设置固定时间自动播报
- **🎵 语音播报**: 直接发送到小智硬件播放
- **📱 快捷命令**: 简化的命令行操作
- **🔄 自动重试**: 网络错误时自动重试
- **📝 详细日志**: 完整的操作日志记录

### 🌟 播报内容示例

**标准格式**：
```
深圳天气播报，现在10点09分，今天晴天，温度24度，天气不错，适合外出活动
```

**定时播报格式**：
```
早上好！北京天气播报，现在08点00分，今天晴朗，温度22度，天气不错，适合外出活动
```

## 🛠️ 可用文件说明

| 文件名 | 功能描述 | 使用场景 |
|--------|----------|----------|
| `无依赖天气获取.py` | 基础天气获取播报 | 立即获取天气 |
| `定时天气播报.py` | 定时自动播报服务 | 自动化天气播报 |
| `天气.py` | 快捷命令工具 | 简化操作 |
| `Python主动天气获取.py` | 完整功能版本 | 高级功能和交互 |

## 📝 使用示例

### 场景1：立即播报天气

```bash
# 播报北京天气
python 无依赖天气获取.py 北京

# 输出示例：
# 2025-08-28 10:09:47 [INFO] 🌤️ Python主动天气播报
# 2025-08-28 10:09:47 [INFO] ✅ 天气播报发送成功！
# 🎉 北京天气播报成功！
# 💡 硬件应该播放天气语音了
```

### 场景2：定时天气播报

```bash
# 启动定时服务
python 定时天气播报.py start

# 自动在以下时间播报：
# - 08:00 (早上好)
# - 12:00 (中午好) 
# - 18:00 (下午好)
# - 22:00 (晚上好)
```

### 场景3：快捷操作

```bash
# 快速播报深圳天气
python 天气.py sz

# 快速播报上海天气  
python 天气.py sh

# 立即播报任意城市
python 天气.py now 杭州
```

## 🔧 高级配置

### 修改播报时间

编辑 `定时天气播报.py` 中的 `broadcast_times`：

```python
self.broadcast_times = [
    time_obj(7, 30),   # 早上7:30
    time_obj(12, 0),   # 中午12:00
    time_obj(17, 30),  # 下午5:30
    time_obj(21, 0)    # 晚上9:00
]
```

### 修改目标设备

修改各文件中的 `DEVICE_ID`：

```python
DEVICE_ID = "你的设备MAC地址"
```

### 修改播报内容格式

在 `format_weather_broadcast` 函数中自定义内容格式。

## 🆚 对比Java推送方式

| 方面 | Java推送（旧） | Python主动（新） |
|------|----------------|------------------|
| **触发方式** | Java定时推送MQTT | Python主动获取 |
| **依赖关系** | 依赖Java后端 | 完全独立 |
| **灵活性** | 受Java控制 | 完全自主控制 |
| **时间控制** | Java端配置 | Python端灵活配置 |
| **错误处理** | 依赖Java状态 | 独立错误处理 |
| **扩展性** | 需要修改Java | 纯Python扩展 |

## 🎯 最佳实践

### 1. 日常使用

```bash
# 每天早上手动触发天气
python 天气.py

# 或者启动自动定时播报
python 定时天气播报.py start
```

### 2. 集成到系统

可以将天气播报加入系统启动脚本：

```bash
# Linux/Mac 添加到 crontab
0 8,12,18,22 * * * cd /path/to/xiaozhi-server && python 无依赖天气获取.py

# Windows 创建计划任务
```

### 3. 监控和日志

所有操作都有详细日志，可以通过日志监控播报状态。

## 🔍 故障排除

### 常见问题

1. **网络超时**
   - 增加 `timeout` 参数
   - 检查网络连接

2. **硬件无声音**
   - 确认设备ID正确
   - 检查Python服务状态
   - 查看播报日志

3. **定时播报不工作**
   - 检查系统时间
   - 确认服务未停止
   - 查看错误日志

### 日志查看

```bash
# 查看实时日志
tail -f xiaozhi-server.log | grep weather
```

## 🚀 后续扩展

1. **真实天气API**: 接入OpenWeatherMap等API
2. **更多城市**: 扩展城市列表
3. **语音优化**: 调整播报语调和内容
4. **Web界面**: 创建Web配置界面
5. **语音交互**: 支持语音询问天气

---

🎉 **Python主动天气获取功能已完全替代Java推送方式！**

现在您可以完全自主控制天气播报，不再依赖Java后端的MQTT推送。
