# 🕒 智能时间确认系统使用指南

## 🎯 功能概述

智能时间确认系统可以处理用户的提醒请求，自动识别时间信息的明确性：
- **明确时间**: 直接保存策略到Java后端
- **模糊时间**: 多轮对话确认具体时间
- **无时间**: 询问用户提供时间信息

## 🚀 API接口

### 1. 发送提醒请求
```http
POST /xiaozhi/reminder/request
Content-Type: application/json

{
  "device_id": "f0:9e:9e:04:8a:44",
  "message": "下周提醒我记得给女儿买生日礼物"
}
```

**响应示例（需要确认时间）:**
```json
{
  "success": true,
  "message": "我理解您想要设置提醒：给女儿买生日礼物。请问您希望在什么时候提醒您呢？",
  "need_follow_up": true,
  "conversation_active": true,
  "task_id": "task_abc123",
  "timestamp": 1693234567.89
}
```

**响应示例（时间明确）:**
```json
{
  "success": true,
  "message": "好的，我会在2024年3月15日 14:00提醒您：开会",
  "need_follow_up": false,
  "conversation_active": false,
  "task_id": "task_def456",
  "timestamp": 1693234567.89
}
```

### 2. 查询对话状态
```http
GET /xiaozhi/reminder/status/{device_id}
```

**响应示例:**
```json
{
  "device_id": "f0:9e:9e:04:8a:44",
  "conversation_active": true,
  "status": {
    "task_id": "task_abc123",
    "extracted_task": "给女儿买生日礼物",
    "attempts": 1,
    "state": "waiting_time",
    "max_attempts": 3
  }
}
```

## 📋 支持的时间表达

### ✅ 明确时间（直接保存）
- "明天下午3点提醒我开会"
- "3月15日上午9点提醒我体检"
- "后天14:30提醒我接孩子"
- "今天晚上8点提醒我看新闻"

### ⚠️ 模糊时间（需要确认）
- "下周提醒我买礼物" → 询问具体日期时间
- "下个月提醒我续费" → 询问具体日期时间
- "周三提醒我开会" → 询问具体时间
- "上午提醒我吃药" → 询问具体日期和时间

### ❌ 缺少时间（需要提供）
- "提醒我交水电费" → 询问什么时候提醒
- "别忘了买菜" → 询问提醒时间
- "记得给妈妈打电话" → 询问提醒时间

## 🔄 对话流程示例

### 场景1: 模糊时间确认
```
👤 用户: "下周提醒我记得给女儿买生日礼物"
🤖 系统: "我理解您想要设置提醒：给女儿买生日礼物。请问您希望在什么时候提醒您呢？"
👤 用户: "下周三下午2点"  
🤖 系统: "完美！我会在2024年3月13日 14:00提醒您：给女儿买生日礼物。提醒已设置成功！"
```

### 场景2: 时间仍不明确
```
👤 用户: "下周提醒我买东西"
🤖 系统: "请问您希望在什么时候提醒您呢？比如'明天下午3点'或'3月15日上午9点'"
👤 用户: "下周吧"
🤖 系统: "时间还不够明确呢。能告诉我具体的提醒时间吗？比如'后天早上8点'"
```

### 场景3: 用户取消
```
👤 用户: "提醒我做作业"
🤖 系统: "请问您希望在什么时候提醒您呢？"
👤 用户: "算了，不用了"
🤖 系统: "好的，已取消设置提醒"
```

## ⚙️ 配置说明

### Java后端接口
需要在Java后端提供策略保存接口：
```
POST /xiaozhi/strategy/reminder
```

### 最大尝试次数
默认最多询问3次时间信息，超过后自动放弃。

### 优先级设置
- 系统回复消息：优先级0（高优先级）
- 确保及时响应用户

## 🧪 测试方法

1. 运行测试脚本：
```bash
python 测试时间确认功能.py
```

2. 手动测试：
```bash
curl -X POST http://47.98.51.180:8003/xiaozhi/reminder/request \
  -H "Content-Type: application/json" \
  -d '{"device_id":"f0:9e:9e:04:8a:44","message":"下周提醒我买礼物"}'
```

3. 查看对话状态：
```bash
curl http://47.98.51.180:8003/xiaozhi/reminder/status/f0:9e:9e:04:8a:44
```

## 🎯 最佳实践

1. **时间表达建议用户**: 
   - 使用"明天下午3点"而非"明天下午"
   - 使用"3月15日"而非"下个月"

2. **错误处理**: 
   - 系统会自动重试3次
   - 超时后用户可重新开始

3. **Java集成**:
   - 确保Java后端策略接口可用
   - 正确处理时间格式(ISO 8601)

## 🎉 预期效果

- ✅ 明确时间的提醒直接设置成功
- ✅ 模糊时间的提醒经过确认后设置成功  
- ✅ 所有成功的提醒都会保存到Java后端
- ✅ 用户获得流畅的对话体验
