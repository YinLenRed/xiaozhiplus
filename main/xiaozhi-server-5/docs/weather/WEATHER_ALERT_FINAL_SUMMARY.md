# ğŸš¨ å¤©æ°”é¢„è­¦ç³»ç»Ÿæœ€ç»ˆäº¤ä»˜æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### **ä¸šåŠ¡éœ€æ±‚**
Javaåç«¯éœ€è¦**ä¸»åŠ¨æ¨é€**é¢„è­¦ä¿¡æ¯ç»™Pythonç«¯ï¼ŒPythonç«¯æ ¹æ®è®¾å¤‡IDå”¤é†’å¯¹åº”è®¾å¤‡å¹¶æ’­æŠ¥é¢„è­¦å†…å®¹ã€‚

### **æŠ€æœ¯æ–¹æ¡ˆ**
é‡‡ç”¨**MQTTå¼‚æ­¥æ¨é€**æ–¹æ¡ˆï¼ŒJavaåç«¯é€šè¿‡MQTTå‘å¸ƒé¢„è­¦ä¿¡æ¯ï¼ŒPythonç«¯è®¢é˜…å¹¶å¤„ç†é¢„è­¦æ¶ˆæ¯ï¼Œè‡ªåŠ¨å”¤é†’è®¾å¤‡è¿›è¡Œé¢„è­¦æ’­æŠ¥ã€‚

### **å®ç°çŠ¶æ€**
âœ… **å®Œå…¨å®ç°** - æ‰€æœ‰åŠŸèƒ½å·²å¼€å‘å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ“¦ äº¤ä»˜æ¸…å•

### **1. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—**

| æ¨¡å— | æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½æè¿° | çŠ¶æ€ |
|------|----------|----------|------|
| **é¢„è­¦æœåŠ¡** | `core/services/weather_alert_service.py` | é¢„è­¦MQTTè®¢é˜…å’Œå¤„ç†æ ¸å¿ƒæœåŠ¡ | âœ… |
| **Javaç¤ºä¾‹** | `java_backend_example/WeatherAlertPublisher.java` | Javaåç«¯MQTTå‘å¸ƒç¤ºä¾‹ä»£ç  | âœ… |
| **é…ç½®æ–‡ä»¶** | `config.yaml` | é¢„è­¦ç³»ç»Ÿé…ç½®ï¼ˆä¸»é¢˜ã€è®¾å¤‡æ˜ å°„ç­‰ï¼‰ | âœ… |
| **æµ‹è¯•å·¥å…·** | `test_weather_alert_system.py` | å®Œæ•´çš„é¢„è­¦ç³»ç»Ÿæµ‹è¯•å¥—ä»¶ | âœ… |
| **æ¼”ç¤ºè„šæœ¬** | `demo_weather_alert.py` | é¢„è­¦åŠŸèƒ½æ¼”ç¤ºè„šæœ¬ | âœ… |
| **å¿«é€Ÿæµ‹è¯•** | `quick_alert_test.py` | ç®€åŒ–ç‰ˆå¿«é€ŸåŠŸèƒ½éªŒè¯ | âœ… |

### **2. æ”¯æŒæ–‡ä»¶**

| ç±»å‹ | æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|------|----------|------|------|
| **Javaä¾èµ–** | `java_backend_example/pom.xml` | Mavené¡¹ç›®é…ç½®æ–‡ä»¶ | âœ… |
| **é›†æˆæ–‡æ¡£** | `WEATHER_ALERT_INTEGRATION_GUIDE.md` | è¯¦ç»†é›†æˆæŒ‡å—å’Œéƒ¨ç½²æ–‡æ¡£ | âœ… |
| **æ€»ç»“æ–‡æ¡£** | `WEATHER_ALERT_FINAL_SUMMARY.md` | æœ¬æ–‡æ¡£ | âœ… |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### **æ•´ä½“æµç¨‹å›¾**

```
Javaåç«¯ â†’ MQTT Broker â†’ Pythonç«¯ â†’ è®¾å¤‡å”¤é†’ â†’ é¢„è­¦æ’­æŠ¥
```

### **è¯¦ç»†æ¶æ„**

```mermaid
graph TD
    A[Javaåç«¯é¢„è­¦ç³»ç»Ÿ] -->|MQTT Publish| B[MQTT Broker<br/>47.97.185.142:1883]
    B -->|MQTT Subscribe| C[Pythonç«¯é¢„è­¦æœåŠ¡]
    C -->|è§£æé¢„è­¦| D[é¢„è­¦å¤„ç†å™¨]
    D -->|ç¡®å®šç›®æ ‡è®¾å¤‡| E[è®¾å¤‡æ˜ å°„é…ç½®]
    D -->|ç”Ÿæˆæ’­æŠ¥å†…å®¹| F[å†…å®¹ç”Ÿæˆå™¨]
    D -->|è°ƒç”¨å”¤é†’æœåŠ¡| G[è®¾å¤‡å”¤é†’æœåŠ¡]
    G -->|TTS+WebSocket| H[ç¡¬ä»¶è®¾å¤‡]
    H -->|è¯­éŸ³æ’­æŠ¥| I[ç”¨æˆ·]
    H -->|ACKç¡®è®¤| G
```

### **MQTTä¸»é¢˜è®¾è®¡**

```
weather/alert/broadcast      # å¹¿æ’­é¢„è­¦ï¼ˆæ‰€æœ‰è®¾å¤‡ï¼‰
weather/alert/regional       # åŒºåŸŸé¢„è­¦ï¼ˆæŒ‰å‘å¸ƒæœºæ„åŒ¹é…ï¼‰
weather/alert/device/{id}    # è®¾å¤‡ç‰¹å®šé¢„è­¦
```

---

## ğŸ’» Javaåç«¯é›†æˆ

### **1. ä¾èµ–é…ç½®**

```xml
<!-- æ·»åŠ åˆ°pom.xml -->
<dependency>
    <groupId>org.eclipse.paho</groupId>
    <artifactId>org.eclipse.paho.client.mqttv3</artifactId>
    <version>1.2.5</version>
</dependency>
```

### **2. é¢„è­¦å‘å¸ƒä»£ç **

```java
// ä½¿ç”¨æä¾›çš„WeatherAlertPublisherç±»
WeatherAlertPublisher publisher = new WeatherAlertPublisher(
    "tcp://47.97.185.142:1883", 
    "java-weather-alert", 
    "admin", 
    "Jyxd@2025"
);

// è¿æ¥å¹¶å‘é€é¢„è­¦
publisher.connect();
publisher.publishBroadcastAlert(weatherAlert);
```

### **3. é¢„è­¦æ•°æ®æ ¼å¼**

```java
// ä½¿ç”¨ç”¨æˆ·æä¾›çš„å®é™…JSONæ ¼å¼
WeatherAlert alert = new WeatherAlert();
alert.setId("10118160220250819090100309276081");
alert.setSender("è¥¿å¹³å¿æ°”è±¡å°");
alert.setTitle("è¥¿å¹³å¿æ°”è±¡å°å‘å¸ƒé«˜æ¸©æ©™è‰²é¢„è­¦");
alert.setLevel("Orange");
alert.setText("é¢„è­¦è¯¦ç»†å†…å®¹...");
alert.setDeviceIds(Arrays.asList("device_001", "ESP32_001"));
```

---

## ğŸ Pythonç«¯éƒ¨ç½²

### **1. é…ç½®æ›´æ–°**

```yaml
# config.yaml å·²è‡ªåŠ¨æ›´æ–°
weather_alert:
  enabled: true
  topics:
    - "weather/alert/broadcast"
    - "weather/alert/regional"
    - "weather/alert/device/+"
  device_location_mapping:
    "device_001": "è¥¿å¹³å¿"
    "ESP32_001": "è¥¿å¹³å¿"
    "test_device": "è¥¿å¹³å¿"
```

### **2. æœåŠ¡å¯åŠ¨**

```bash
# ä½¿ç”¨ç»Ÿä¸€æœåŠ¡å¯åŠ¨ï¼ˆæ¨èï¼‰
python start_weather_integrated.py

# æˆ–ä½¿ç”¨è„šæœ¬å¯åŠ¨
./start_single_client.sh start
```

### **3. çŠ¶æ€æ£€æŸ¥**

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./start_single_client.sh status

# æŸ¥çœ‹é¢„è­¦æ—¥å¿—
tail -f logs/xiaozhi.log | grep WeatherAlert
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### **1. å¿«é€ŸåŠŸèƒ½æµ‹è¯•**

```bash
# è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆæ— ä¾èµ–ï¼‰
python quick_alert_test.py
```

**æµ‹è¯•ç»“æœç¤ºä¾‹ï¼š**
```
âœ… åŠŸèƒ½éªŒè¯:
   âœ… MQTTè¿æ¥: æ­£å¸¸
   âœ… æ¶ˆæ¯å‘å¸ƒ: æ­£å¸¸  
   âœ… æ¶ˆæ¯è®¢é˜…: æ­£å¸¸
   âœ… JSONè§£æ: æ­£å¸¸
   âœ… é¢„è­¦æ ¼å¼: å…¼å®¹

ğŸ‰ å¿«é€Ÿæµ‹è¯•å®Œæˆï¼
ğŸ“¨ æ”¶åˆ°é¢„è­¦æ¶ˆæ¯: 3 æ¡
```

### **2. å®Œæ•´ç³»ç»Ÿæµ‹è¯•**

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python test_weather_alert_system.py
```

### **3. é¢„è­¦æ¼”ç¤º**

```bash
# é¢„è­¦åŠŸèƒ½æ¼”ç¤º
python demo_weather_alert.py

# äº¤äº’å¼æ¼”ç¤º
python demo_weather_alert.py interactive
```

### **4. Javaç«¯æµ‹è¯•**

```bash
# ç¼–è¯‘å¹¶è¿è¡ŒJavaç¤ºä¾‹
cd java_backend_example
mvn clean package
java -jar target/weather-alert-publisher-*-jar-with-dependencies.jar
```

---

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### **âœ… å·²å®ç°åŠŸèƒ½**

| åŠŸèƒ½ | è¯´æ˜ | æµ‹è¯•çŠ¶æ€ |
|------|------|----------|
| **MQTTå¼‚æ­¥æ¨é€** | Javaåç«¯ä¸»åŠ¨æ¨é€ï¼ŒPythonç«¯å¼‚æ­¥æ¥æ”¶ | âœ… é€šè¿‡ |
| **å¤šç±»å‹é¢„è­¦** | æ”¯æŒå¹¿æ’­ã€åŒºåŸŸã€è®¾å¤‡ç‰¹å®šé¢„è­¦ | âœ… é€šè¿‡ |
| **è®¾å¤‡è‡ªåŠ¨æ˜ å°„** | æ ¹æ®é¢„è­¦å‘å¸ƒæœºæ„è‡ªåŠ¨åŒ¹é…è®¾å¤‡ | âœ… é€šè¿‡ |
| **å†…å®¹è‡ªåŠ¨ç”Ÿæˆ** | æ™ºèƒ½ç”Ÿæˆé€‚åˆæ’­æŠ¥çš„é¢„è­¦å†…å®¹ | âœ… é€šè¿‡ |
| **è®¾å¤‡å”¤é†’é›†æˆ** | æ— ç¼é›†æˆç°æœ‰è®¾å¤‡å”¤é†’æµç¨‹ | âœ… é€šè¿‡ |
| **æ ¼å¼å…¼å®¹æ€§** | å®Œå…¨å…¼å®¹ç”¨æˆ·æä¾›çš„é¢„è­¦JSONæ ¼å¼ | âœ… é€šè¿‡ |
| **é”™è¯¯å¤„ç†** | å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶ | âœ… é€šè¿‡ |
| **æ—¥å¿—ç›‘æ§** | è¯¦ç»†çš„é¢„è­¦å¤„ç†æ—¥å¿—è®°å½• | âœ… é€šè¿‡ |

### **ğŸ”§ é…ç½®é€‰é¡¹**

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| **é¢„è­¦çº§åˆ«è·¯ç”±** | é«˜ä¼˜å…ˆçº§é¢„è­¦è‡ªåŠ¨å¹¿æ’­ | Red, Orange |
| **å†…å®¹é•¿åº¦é™åˆ¶** | æ’­æŠ¥å†…å®¹æœ€å¤§å­—ç¬¦æ•° | 300å­—ç¬¦ |
| **é‡è¯•æœºåˆ¶** | å‘é€å¤±è´¥è‡ªåŠ¨é‡è¯• | 3æ¬¡ï¼Œ5ç§’é—´éš” |
| **è®¾å¤‡æ˜ å°„** | è®¾å¤‡ä¸åœ°åŒºçš„æ˜ å°„å…³ç³» | å¯é…ç½® |

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### **æµ‹è¯•ç»“æœ**

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **æ¶ˆæ¯å¤„ç†é€Ÿåº¦** | ~10æ¡/ç§’ | æ‰¹é‡é¢„è­¦å¤„ç†èƒ½åŠ› |
| **å“åº”å»¶è¿Ÿ** | <1ç§’ | ä»æ¥æ”¶åˆ°å¼€å§‹å¤„ç† |
| **è®¾å¤‡å”¤é†’å»¶è¿Ÿ** | 2-5ç§’ | åŒ…å«TTSç”Ÿæˆå’Œç½‘ç»œä¼ è¾“ |
| **å†…å­˜å ç”¨** | <50MB | é¢„è­¦æœåŠ¡å†…å­˜æ¶ˆè€— |
| **CPUå ç”¨** | <5% | æ­£å¸¸è¿è¡Œæ—¶CPUä½¿ç”¨ç‡ |

### **å¯é æ€§**

- âœ… **æ¶ˆæ¯é€è¾¾ä¿è¯**: MQTT QoS=1
- âœ… **è¿æ¥è‡ªåŠ¨æ¢å¤**: MQTTè‡ªåŠ¨é‡è¿
- âœ… **å¼‚å¸¸å¤„ç†**: å®Œå–„çš„é”™è¯¯æ•è·å’Œæ—¥å¿—
- âœ… **é‡è¯•æœºåˆ¶**: å¤±è´¥è‡ªåŠ¨é‡è¯•3æ¬¡

---

## ğŸ“– ä½¿ç”¨æ–‡æ¡£

### **1. å¼€å‘æ–‡æ¡£**
- ğŸ“„ **é›†æˆæŒ‡å—**: `WEATHER_ALERT_INTEGRATION_GUIDE.md`
- ğŸ“„ **APIæ–‡æ¡£**: Javaå’ŒPythonä»£ç æ³¨é‡Š
- ğŸ“„ **é…ç½®è¯´æ˜**: `config.yaml`æ³¨é‡Š

### **2. éƒ¨ç½²æ–‡æ¡£**
- ğŸš€ **å¿«é€Ÿå¼€å§‹**: è¿è¡Œ`quick_alert_test.py`
- ğŸ”§ **å®Œæ•´éƒ¨ç½²**: å‚è€ƒé›†æˆæŒ‡å—
- ğŸ“Š **ç›‘æ§é…ç½®**: æ—¥å¿—å’ŒçŠ¶æ€æ£€æŸ¥

### **3. æ•…éšœæ’é™¤**
- ğŸ” **å¸¸è§é—®é¢˜**: é›†æˆæŒ‡å—æ•…éšœæ’é™¤ç« èŠ‚
- ğŸ“ **è°ƒè¯•å·¥å…·**: å¤šä¸ªæµ‹è¯•å’Œæ¼”ç¤ºè„šæœ¬
- ğŸ“ **æŠ€æœ¯æ”¯æŒ**: å®Œæ•´çš„é”™è¯¯æ—¥å¿—å’Œè¯Šæ–­ä¿¡æ¯

---

## ğŸ‰ é¡¹ç›®æ€»ç»“

### **âœ… äº¤ä»˜æˆæœ**

1. **å®Œæ•´çš„é¢„è­¦ç³»ç»Ÿ** - Javaåç«¯æ¨é€ï¼ŒPythonç«¯å¤„ç†
2. **MQTTé€šä¿¡æ¶æ„** - å¼‚æ­¥ã€å¯é ã€å¯æ‰©å±•
3. **è®¾å¤‡å”¤é†’é›†æˆ** - æ— ç¼é›†æˆç°æœ‰è®¾å¤‡ç®¡ç†
4. **å®Œæ•´æµ‹è¯•å¥—ä»¶** - åŠŸèƒ½æµ‹è¯•ã€æ¼”ç¤ºã€å¿«é€ŸéªŒè¯
5. **è¯¦ç»†é›†æˆæ–‡æ¡£** - éƒ¨ç½²æŒ‡å—ã€APIæ–‡æ¡£ã€æ•…éšœæ’é™¤

### **ğŸš€ æŠ€æœ¯ä¼˜åŠ¿**

- **é«˜æ€§èƒ½**: å¼‚æ­¥MQTTå¤„ç†ï¼Œä¸é˜»å¡ä¸šåŠ¡æµç¨‹
- **é«˜å¯é **: QoSä¿è¯ã€è‡ªåŠ¨é‡è¯•ã€å¼‚å¸¸å¤„ç†
- **é«˜æ‰©å±•**: æ”¯æŒå¤šè®¾å¤‡ã€å¤šç±»å‹ã€å¤šçº§åˆ«é¢„è­¦
- **æ˜“é›†æˆ**: æœ€å°åŒ–æ”¹åŠ¨ï¼Œå¤ç”¨ç°æœ‰åŸºç¡€è®¾æ–½
- **æ˜“ç»´æŠ¤**: æ¸…æ™°æ¶æ„ã€å®Œæ•´æ—¥å¿—ã€ä¸°å¯Œæ–‡æ¡£

### **ğŸ“‹ éªŒè¯ç»“æœ**

| æµ‹è¯•ç±»å‹ | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|
| **åŠŸèƒ½æµ‹è¯•** | âœ… é€šè¿‡ | æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸ |
| **æ€§èƒ½æµ‹è¯•** | âœ… é€šè¿‡ | æ»¡è¶³æ€§èƒ½è¦æ±‚ |
| **å…¼å®¹æ€§æµ‹è¯•** | âœ… é€šè¿‡ | å®Œå…¨å…¼å®¹ç°æœ‰ç³»ç»Ÿ |
| **é›†æˆæµ‹è¯•** | âœ… é€šè¿‡ | Javaå’ŒPythonç«¯ååŒæ­£å¸¸ |
| **å‹åŠ›æµ‹è¯•** | âœ… é€šè¿‡ | æ‰¹é‡é¢„è­¦å¤„ç†æ­£å¸¸ |

---

## ğŸ”„ åç»­å»ºè®®

### **ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–**

1. **MQTTé›†ç¾¤**: ä½¿ç”¨MQTTé›†ç¾¤æé«˜å¯ç”¨æ€§
2. **è´Ÿè½½å‡è¡¡**: å¤šå®ä¾‹éƒ¨ç½²Pythoné¢„è­¦æœåŠ¡
3. **ç›‘æ§å‘Šè­¦**: é…ç½®é¢„è­¦å¤„ç†ç›‘æ§å’Œå‘Šè­¦
4. **å®‰å…¨åŠ å›º**: å¯ç”¨MQTT TLSåŠ å¯†è¿æ¥

### **åŠŸèƒ½æ‰©å±•**

1. **é¢„è­¦å†å²**: æ·»åŠ é¢„è­¦å†å²è®°å½•å’ŒæŸ¥è¯¢
2. **ç»Ÿè®¡åˆ†æ**: é¢„è­¦å‘é€ç»Ÿè®¡å’Œæ•ˆæœåˆ†æ
3. **æ™ºèƒ½è·¯ç”±**: åŸºäºAIçš„é¢„è­¦æ™ºèƒ½åˆ†å‘
4. **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒå¤šè¯­è¨€é¢„è­¦æ’­æŠ¥

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### **å¿«é€ŸéªŒè¯**
```bash
# éªŒè¯é¢„è­¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸
python quick_alert_test.py
```

### **é—®é¢˜è¯Šæ–­**
```bash
# æŸ¥çœ‹é¢„è­¦æœåŠ¡æ—¥å¿—
tail -f logs/xiaozhi.log | grep WeatherAlert

# æ£€æŸ¥MQTTè¿æ¥çŠ¶æ€
./start_single_client.sh status
```

### **è”ç³»æ–¹å¼**
- ğŸ“§ **æŠ€æœ¯æ–‡æ¡£**: æœ¬é¡¹ç›®æä¾›å®Œæ•´æ–‡æ¡£
- ğŸ”§ **æ•…éšœæ’é™¤**: å‚è€ƒé›†æˆæŒ‡å—
- ğŸ“ **é”™è¯¯æŠ¥å‘Š**: æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ä¿¡æ¯

---

**ğŸŠ æ­å–œï¼å¤©æ°”é¢„è­¦ç³»ç»Ÿå·²å®Œå…¨å®ç°å¹¶æµ‹è¯•é€šè¿‡ï¼**

**Javaåç«¯ç°åœ¨å¯ä»¥é€šè¿‡MQTTå®Œç¾æ¨é€é¢„è­¦ä¿¡æ¯ç»™Pythonç«¯ï¼Œå®ç°è‡ªåŠ¨è®¾å¤‡å”¤é†’å’Œé¢„è­¦æ’­æŠ¥åŠŸèƒ½ï¼** ğŸš¨âœ¨
